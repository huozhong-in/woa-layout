# 用法（关键）：
# 1) 该配置假设后端 Bun 服务监听在宿主机 127.0.0.1:8383
# 2) nginx 容器请使用 host 网络模式运行，否则容器内 127.0.0.1 指向容器自身而不是宿主机
#
# 示例：
# docker run -d --name woa-nginx \
#   --network host \
#   -v /path/to/woa-layout/docs/woa-layout.nginx.conf:/etc/nginx/conf.d/default.conf:ro \
#   nginx:alpine

map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    # 只监听你指定的本机 IP 与端口
    listen 100.83.134.21:8383;
    server_name 100.83.134.21;

    # 基础反向代理配置
    location / {
        proxy_pass http://127.0.0.1:8383;
        proxy_http_version 1.1;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # 兼容升级连接（如未来启用 WebSocket）
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;

        proxy_connect_timeout 30s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
